import { request } from "./util.js"
import { map_song_list } from "./util.js"

export const get_song_url = async (id, cookie = 'NMTID=00O2s-GW2FETzBOwEX-sFHQk7dWUb0AAAGOLgPZ0A; _iuqxldmzr_=32; _ntes_nnid=ca7ddef165335a0b966f7494ddb9fd3f,1710168986177; _ntes_nuid=ca7ddef165335a0b966f7494ddb9fd3f; WEVNSM=1.0.0; WNMCID=kxfhiy.1710168986884.01.0; WM_TID=3n9259S9kd9BQEEVVRfEqQioRB7td7LD; sDeviceId=YD-e72jeUkeGMpFRkQBEAfBrA3oVArpfhgO; ntes_utid=tid._.H6QzsmWha%252FFAUkURUBLU6QitVF%252FoO4NN._.0; __snaker__id=viVmrGtVWopQbLTV; ntes_kaola_ad=1; P_INFO=18606338551|1712663813|1|music|00&99|null&null&null#shd&371100#10#0|&0||18606338551; __remember_me=true; __csrf=3b67aebe081ddc14155a39a2b5f08e15; MUSIC_U=00A938A7C31E4FDE0452E46B4CF8DD8A6912218BBBAF3AED1A216F25A1C296AC8F4C4FB7A22D8039F6E9AA1B1758BA10D7032763092B901AF4760E445EF1BC6BF05042BCFD906F0AB8995B422D0F5564A1AE2C08BEA1092066CE0164ADF0152B1F8EB85D95A3112E83FE345548C2E2552A84938539FCFBBDE1B1008808C13D85DEE44C9F38EF5E0935AB037D58CF36C34C63A05E701E1611DF9F211C878B4A0B5A13ED6DFCFAEE27A043904BA256297DF8BF94B501584DFF8FF558EE6E68058ABA86ADDE6784E403DD0E49AA3AB1AE889B58C89B5E1D6CA2D404F7ABFA9DBFC1FC70048B23FEE8E85F59E1D234573E32FB71091241914764474F90D78E126C658AEBEE0B723C0CAFCA9FDAF3E517CB67F9CB8C094F9484DDA25F631FD1B4AABE3F6226B7B55E063883A3EB8071C0BECEC88D466DF9BB99A4C402AD96D0D0E4F1A534C329E9F3B5EFA0FB74A06684F481A9; gdxidpyhxdE=mf5mJBAHnhvWMGonRPAQtb8qC5YElNE06K9HgZDQtzYnKAjlc7%5Cl1wavY9%2BVs3%5CB19JWa5%2FVbyGdoo0V2imUrZYddkwyha36frCyT57ByOY0rdw6ypoWxf0wA0zRBWyRA20VT5hfJuDQbnDQfI%2BvIl8gZxM8KBQWLDt3t7UJdmPUjJE0%3A1715498587470; JSESSIONID-WYYY=kcAQXjtJNmIVPl43e79zAZp31gQoQyxIkoryhxBGqb1YIgQmtnhcN6%2F7fv0Hv1ko5tHnOS6PrBMCRVQimWrDw4Gya%2Bl1cRDGOVPXg9Bogh69%5C8gGgZ7kcvOTkaV3NUJ0Eywfa8dn7HhOOdEf4QrxJqUeo8ZpJbvRPHGBm5ZKvCBes1ux%3A1715956772324; WM_NI=3BkOEmDZ0TpIClkMLgXEDwYEQp1ieJbgYP9MqNCC6JWphyuX7MP5lYydlG%2BOFg5RaSZUX9%2Be02UCqhxshyvSHueHndNYWfxyGP4w5gLY1iZz6oWN4G85TGZY2JiAwbdVaTc%3D; WM_NIKE=9ca17ae2e6ffcda170e2e6ee83e26ff4f1a193c167bbb48fa7c55e879f9e86c421fb8ba1d7d16587effcadb12af0fea7c3b92af19ea5b0c867888600b5f34381b4a5aecf6d9c9b8c98dc4f93b0ff8ae842a2b997b1bc47b3928da4b54295b0a89af854f593a0d6ef53bbbca4a8aa4586b9fbb3e4599a8b98daaa6ff4ee9ba4f464bcada89af5598cababa9ed708e879987fb738590fc98b86d9087ff8ad972f6b199afb74dfceb9ca8d953f296a7a2f66aa88aafb5e237e2a3') => {

    const data = {
        ids: '[' + id + ']',
        level: 'standard',
        encodeType: 'flac',
    }

    const res = await request(
        'POST',
        `https://interface.music.163.com/eapi/song/enhance/player/url/v1`,
        data,
        {
            crypto: 'eapi',
            url: '/api/song/enhance/player/url/v1',
            cookie: {}
        },
    )
    // console.log(res)
    const url = res.data[0]?.url?.replace('http://', 'https://')

    return url || `https://music.163.com/song/media/outer/url?id=${id}.mp3`

}

export const get_song_info = async (id, cookie = 'NMTID=00O2s-GW2FETzBOwEX-sFHQk7dWUb0AAAGOLgPZ0A; _iuqxldmzr_=32; _ntes_nnid=ca7ddef165335a0b966f7494ddb9fd3f,1710168986177; _ntes_nuid=ca7ddef165335a0b966f7494ddb9fd3f; WEVNSM=1.0.0; WNMCID=kxfhiy.1710168986884.01.0; WM_TID=3n9259S9kd9BQEEVVRfEqQioRB7td7LD; sDeviceId=YD-e72jeUkeGMpFRkQBEAfBrA3oVArpfhgO; ntes_utid=tid._.H6QzsmWha%252FFAUkURUBLU6QitVF%252FoO4NN._.0; __snaker__id=viVmrGtVWopQbLTV; ntes_kaola_ad=1; P_INFO=18606338551|1712663813|1|music|00&99|null&null&null#shd&371100#10#0|&0||18606338551; __remember_me=true; __csrf=3b67aebe081ddc14155a39a2b5f08e15; MUSIC_U=00A938A7C31E4FDE0452E46B4CF8DD8A6912218BBBAF3AED1A216F25A1C296AC8F4C4FB7A22D8039F6E9AA1B1758BA10D7032763092B901AF4760E445EF1BC6BF05042BCFD906F0AB8995B422D0F5564A1AE2C08BEA1092066CE0164ADF0152B1F8EB85D95A3112E83FE345548C2E2552A84938539FCFBBDE1B1008808C13D85DEE44C9F38EF5E0935AB037D58CF36C34C63A05E701E1611DF9F211C878B4A0B5A13ED6DFCFAEE27A043904BA256297DF8BF94B501584DFF8FF558EE6E68058ABA86ADDE6784E403DD0E49AA3AB1AE889B58C89B5E1D6CA2D404F7ABFA9DBFC1FC70048B23FEE8E85F59E1D234573E32FB71091241914764474F90D78E126C658AEBEE0B723C0CAFCA9FDAF3E517CB67F9CB8C094F9484DDA25F631FD1B4AABE3F6226B7B55E063883A3EB8071C0BECEC88D466DF9BB99A4C402AD96D0D0E4F1A534C329E9F3B5EFA0FB74A06684F481A9; gdxidpyhxdE=mf5mJBAHnhvWMGonRPAQtb8qC5YElNE06K9HgZDQtzYnKAjlc7%5Cl1wavY9%2BVs3%5CB19JWa5%2FVbyGdoo0V2imUrZYddkwyha36frCyT57ByOY0rdw6ypoWxf0wA0zRBWyRA20VT5hfJuDQbnDQfI%2BvIl8gZxM8KBQWLDt3t7UJdmPUjJE0%3A1715498587470; JSESSIONID-WYYY=kcAQXjtJNmIVPl43e79zAZp31gQoQyxIkoryhxBGqb1YIgQmtnhcN6%2F7fv0Hv1ko5tHnOS6PrBMCRVQimWrDw4Gya%2Bl1cRDGOVPXg9Bogh69%5C8gGgZ7kcvOTkaV3NUJ0Eywfa8dn7HhOOdEf4QrxJqUeo8ZpJbvRPHGBm5ZKvCBes1ux%3A1715956772324; WM_NI=3BkOEmDZ0TpIClkMLgXEDwYEQp1ieJbgYP9MqNCC6JWphyuX7MP5lYydlG%2BOFg5RaSZUX9%2Be02UCqhxshyvSHueHndNYWfxyGP4w5gLY1iZz6oWN4G85TGZY2JiAwbdVaTc%3D; WM_NIKE=9ca17ae2e6ffcda170e2e6ee83e26ff4f1a193c167bbb48fa7c55e879f9e86c421fb8ba1d7d16587effcadb12af0fea7c3b92af19ea5b0c867888600b5f34381b4a5aecf6d9c9b8c98dc4f93b0ff8ae842a2b997b1bc47b3928da4b54295b0a89af854f593a0d6ef53bbbca4a8aa4586b9fbb3e4599a8b98daaa6ff4ee9ba4f464bcada89af5598cababa9ed708e879987fb738590fc98b86d9087ff8ad972f6b199afb74dfceb9ca8d953f296a7a2f66aa88aafb5e237e2a3') => {
    const ids = [id]
    const data = {
        c: '[' + ids.map((id) => '{"id":' + id + '}').join(',') + ']',
    }
    let res = await request('POST', `https://music.163.com/api/v3/song/detail`, data, {
        crypto: 'weapi',
    })

    // console.log(res)

    if (!res.songs) {
        throw res
    }

    res = map_song_list(res)
    return res
}


// const res = await get_song_info('1874976923');
// console.log(res)

